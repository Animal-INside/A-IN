<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.team.ain.mapper.PostMapper">

    <!-- 게시물 생성 -->
    <insert id="createPost" parameterType="com.team.ain.dto.post.Post">
        INSERT INTO posts (content, image_url, created_at, member_id)
        VALUES (#{content}, #{imageUrl}, NOW(), #{memberId});
    </insert>

    <!-- 게시물 수정 -->
    <update id="updatePost" parameterType="com.team.ain.dto.post.Post">
        UPDATE posts
        SET content = #{content}, image_url = #{imageUrl}
        WHERE id = #{id} AND member_id = #{memberId};
    </update>

    <!-- 게시물 삭제 -->
    <delete id="deletePost" parameterType="long">
        DELETE FROM posts
        WHERE id = #{id} AND member_id = #{memberId};
    </delete>

    <!-- 게시물 상세 조회 -->
    <select id="getPostById" parameterType="long" resultType="com.team.ain.dto.post.Post">
        SELECT id, content, image_url AS imageUrl, created_at AS createdAt, member_id AS memberId
        FROM posts
        WHERE id = #{id};
    </select>

    <!-- 게시물 목록 조회 (Infinite Scroll 지원) -->
    <select id="getPosts" parameterType="map" resultType="com.team.ain.dto.post.Post">
        SELECT id, content, image_url AS imageUrl, created_at AS createdAt, member_id AS memberId
        FROM posts
        ORDER BY created_at DESC
        LIMIT #{size} OFFSET #{offset};
    </select>

    <!-- 게시물 총 개수 조회(infinite scroll페이지수 계산) -->
    <select id="getPostCount" resultType="int">
        SELECT COUNT(*)
        FROM posts;
    </select>

</mapper>
